{% extends 'base.html' %}
{% block title %}Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± | Ù…Ù†ØµØ© Ø·ÙŠØ¨Ø© Ø§Ù„ØµÙˆØªÙŠØ©{% endblock %}

{% block content %}
<div class="page-head">
  <nav class="breadcrumb" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„">
    <a href="{% url 'service:dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <span class="separator">â€º</span>
    <a href="{% url 'service:inquiry_detail' inquiry.pk %}">{{ inquiry.title|truncatewords:5 }}</a>
    <span class="separator">â€º</span>
    <span>ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</span>
  </nav>
  <h1>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±</h1>
</div>

<!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
<div class="card">
  <h2>Ø§Ù„Ø³Ø¤Ø§Ù„</h2>
  <p class="para">
    {% if inquiry.transcription_text %}
      {{ inquiry.transcription_text|linebreaksbr }}
    {% else %}
      {{ inquiry.question_text|linebreaksbr }}
    {% endif %}
  </p>
  <button class="tts-btn" data-tts="{{ inquiry.transcription_text|default:inquiry.question_text|escapejs }}" aria-label="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">
    ğŸ”Š Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
  </button>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
<div class="card">
  <h2>Ø¥Ø¬Ø§Ø¨ØªÙƒ</h2>
  <form method="post" class="form">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <div class="form-row">
      <label for="{{ form.answer_text.id_for_label }}">Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© *</label>
      {{ form.answer_text }}
      {{ form.answer_text.errors }}
    </div>

    <div class="form-row">
      <label for="{{ form.internal_notes.id_for_label }}">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ©</label>
      {{ form.internal_notes }}
      {{ form.internal_notes.errors }}
      <p class="field-hint">Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù† ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·.</p>
    </div>

    <div class="form-actions">
      <button class="btn success" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
      <a class="btn outline" href="{% url 'service:inquiry_detail' inquiry.pk %}">Ø¥Ù„ØºØ§Ø¡</a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.tts-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const text = this.dataset.tts;
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ar-SA';
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);
    }
  });
});
</script>
{% endblock %}
