{% extends 'base.html' %}
{% block title %}{{ inquiry.title }} | Ù…Ù†ØµØ© Ø·ÙŠØ¨Ø© Ø§Ù„ØµÙˆØªÙŠØ©{% endblock %}

{% block content %}
<div class="page-head">
  <nav class="breadcrumb" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„">
    <a href="{% url 'service:dashboard' %}">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <span class="separator">â€º</span>
    <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±</span>
  </nav>
  <h1>{{ inquiry.title }}</h1>
  <div class="meta-badges">
    <span class="badge {{ inquiry.status_badge_class }}">{{ inquiry.get_status_display }}</span>
    <span class="badge {{ inquiry.priority_badge_class }}">{{ inquiry.get_priority_display }}</span>
    <span class="meta-date">{{ inquiry.created_at|date:"Y/m/d - H:i" }}</span>
  </div>
</div>

<div class="inquiry-detail">
  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„ -->
  <div class="card">
    <h2>Ø§Ù„Ø³Ø¤Ø§Ù„</h2>

    {% if inquiry.question_audio %}
      <div class="audio-player">
        <audio controls preload="metadata">
          <source src="{{ inquiry.question_audio.url }}" type="audio/mpeg">
          Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª.
        </audio>
        <p class="hint">ğŸ¤ Ù…Ù„Ù ØµÙˆØªÙŠ Ù…Ø±ÙÙ‚</p>
      </div>
    {% endif %}

    {% if inquiry.transcription_text %}
      <div class="question-text">
        <h3>Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ±Øº</h3>
        <p class="para">{{ inquiry.transcription_text|linebreaksbr }}</p>
        <button class="tts-btn" type="button"
                data-tts-text="{{ inquiry.transcription_text|escapejs }}"
                aria-label="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">
          ğŸ”Š Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
        </button>
      </div>
    {% elif inquiry.question_text %}
      <div class="question-text">
        <p class="para">{{ inquiry.question_text|linebreaksbr }}</p>
        <button class="tts-btn" type="button"
                data-tts-text="{{ inquiry.question_text|escapejs }}"
                aria-label="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„">
          ğŸ”Š Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
        </button>
      </div>
    {% endif %}

    <div class="meta-info">
      <span>Ø£Ø±Ø³Ù„Ù‡: <strong>{{ inquiry.created_by.username }}</strong></span>
      <span>Ø¨ØªØ§Ø±ÙŠØ®: <strong>{{ inquiry.created_at|date:"Y/m/d - H:i" }}</strong></span>
    </div>
  </div>

  <!-- Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
  {% if inquiry.answer_text %}
  <div class="card answer-card">
    <h2>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</h2>
    <p class="para">{{ inquiry.answer_text|linebreaksbr }}</p>
    <button class="tts-btn" type="button"
            data-tts-text="{{ inquiry.answer_text|escapejs }}"
            aria-label="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©">
      ğŸ”Š Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    </button>
    <div class="meta-info">
      <span>Ø£Ø¬Ø§Ø¨ Ø¹Ù„ÙŠÙ‡: <strong>{{ inquiry.answered_by.username }}</strong></span>
      <span>Ø¨ØªØ§Ø±ÙŠØ®: <strong>{{ inquiry.answered_at|date:"Y/m/d - H:i" }}</strong></span>
      {% if inquiry.response_time %}
        <span>ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <strong>{{ inquiry.response_time }} Ø³Ø§Ø¹Ø©</strong></span>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© (Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† ÙÙ‚Ø·) -->
  {% if is_librarian and inquiry.internal_notes %}
  <div class="card internal-notes">
    <h2>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ©</h2>
    <p class="para">{{ inquiry.internal_notes|linebreaksbr }}</p>
  </div>
  {% endif %}

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
  <div class="actions-card">
    {% if is_librarian %}
      {% if inquiry.status == 'new' and inquiry.question_audio %}
        <a class="btn primary" href="{% url 'service:inquiry_transcribe' inquiry.pk %}">
          âœï¸ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ø¤Ø§Ù„
        </a>
      {% endif %}

      {% if inquiry.status in 'new,transcribed,in_progress' %}
        <a class="btn success" href="{% url 'service:inquiry_answer' inquiry.pk %}">
          âœ… ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        </a>
      {% endif %}

      {% if inquiry.status == 'answered' %}
        <a class="btn outline" href="{% url 'service:inquiry_answer' inquiry.pk %}">
          âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        </a>
      {% endif %}

      {% if inquiry.status != 'closed' %}
        <a class="btn danger-outline" href="{% url 'service:inquiry_close' inquiry.pk %}">
          ğŸ”’ Ø¥ØºÙ„Ø§Ù‚
        </a>
      {% endif %}
    {% else %}
      {% if inquiry.status == 'closed' %}
        <p class="muted">Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ù…ØºÙ„Ù‚.</p>
      {% elif inquiry.status == 'answered' %}
        <p class="success-text">âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ.</p>
      {% else %}
        <p class="muted">â³ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
      {% endif %}
    {% endif %}

    <a class="btn secondary" href="{% url 'service:dashboard' %}">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </div>
</div>
{% endblock %}
