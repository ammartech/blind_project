{% extends 'base.html' %}
{% block title %}Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª | Ù…Ù†ØµØ© Ø·ÙŠØ¨Ø© Ø§Ù„ØµÙˆØªÙŠØ©{% endblock %}

{% block content %}
<div class="page-head">
  <h1>Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª</h1>
  <p class="muted">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ØµØ·Ù„Ø­Ø§Øª ØªØ®ØµØµÙŠØ© ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª â€” Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø© ØµÙˆØªÙŠØ©.</p>
</div>

<div class="card">
  <form method="get" class="search-row">
    <input class="input" name="q" value="{{ q }}" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ØµØ·Ù„Ø­..." aria-label="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª">
    <select class="input select" name="category" aria-label="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ">
      <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
      {% for cat in categories %}
        <option value="{{ cat.pk }}" {% if selected_category == cat.pk|stringformat:"d" %}selected{% endif %}>
          {% if cat.icon %}{{ cat.icon }} {% endif %}{{ cat.name }} ({{ cat.num_terms }})
        </option>
      {% endfor %}
    </select>
    <button class="btn secondary" type="submit">ğŸ” Ø¨Ø­Ø«</button>
    {% if q or selected_category %}
      <a class="btn outline" href="{% url 'service:glossary_list' %}">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø«</a>
    {% endif %}
  </form>

  <div class="actions-bar">
    {% if user.is_authenticated and user.is_librarian %}
      <a class="btn primary" href="{% url 'service:glossary_new' %}">+ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ·Ù„Ø­</a>
      <a class="btn secondary" href="{% url 'service:category_list' %}">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a>
    {% endif %}
  </div>

  {% if q or selected_category %}
    <p class="search-results-info">
      {% if q %}Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: <strong>"{{ q }}"</strong>{% endif %}
      {% if selected_category %}{% for cat in categories %}{% if cat.pk|stringformat:"d" == selected_category %} ÙÙŠ ØªØµÙ†ÙŠÙ: <strong>{{ cat.name }}</strong>{% endif %}{% endfor %}{% endif %}
    </p>
  {% endif %}

  {% if terms %}
    <div class="list-cards">
      {% for t in terms %}
        <a class="list-card" href="{% url 'service:glossary_detail' t.pk %}">
          <div class="list-title">{{ t.term }}</div>
          <div class="list-preview">{{ t.definition|truncatewords:20 }}</div>
          <div class="list-meta">
            {% if t.category %}
              <span class="term-badge">{% if t.category.icon %}{{ t.category.icon }} {% endif %}{{ t.category.name }}</span>
            {% endif %}
            <span>ğŸ‘ {{ t.view_count }}</span>
            <span>ğŸ”Š {{ t.tts_play_count }}</span>
            <span>Ø§Ø¶ØºØ· Ù„Ù„ØªÙØ§ØµÙŠÙ„</span>
          </div>
        </a>
      {% endfor %}
    </div>

    {% if terms.has_other_pages %}
    <nav class="pagination" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª">
      {% if terms.has_previous %}
        <a class="page-link" href="?page={{ terms.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
      {% endif %}
      <span class="page-info">ØµÙØ­Ø© {{ terms.number }} Ù…Ù† {{ terms.paginator.num_pages }}</span>
      {% if terms.has_next %}
        <a class="page-link" href="?page={{ terms.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">Ø§Ù„ØªØ§Ù„ÙŠ</a>
      {% endif %}
    </nav>
    {% endif %}
  {% else %}
    <div class="empty-state">
      <p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>
      {% if user.is_authenticated and user.is_librarian %}
        <a class="btn primary" href="{% url 'service:glossary_new' %}">Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…ØµØ·Ù„Ø­</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
